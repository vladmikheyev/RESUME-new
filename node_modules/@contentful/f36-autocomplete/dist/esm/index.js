import n, { useState, useCallback } from 'react';
import { cx, css } from 'emotion';
import { useCombobox } from 'downshift';
import { mergeRefs } from '@contentful/f36-core';
import { IconButton } from '@contentful/f36-button';
import { TextInput } from '@contentful/f36-forms';
import { ChevronDownIcon, CloseIcon } from '@contentful/f36-icons';
import { Skeleton } from '@contentful/f36-skeleton';
import { Popover } from '@contentful/f36-popover';
import { Subheading, SectionHeading, Text } from '@contentful/f36-typography';
import { getStringMatch } from '@contentful/f36-utils';
import a from '@contentful/f36-tokens';

var ke=Object.defineProperty,Le=Object.defineProperties;var Ne=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var z=(t,o,i)=>o in t?ke(t,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[o]=i,u=(t,o)=>{for(var i in o||(o={}))j.call(o,i)&&z(t,i,o[i]);if(H)for(var i of H(o))J.call(o,i)&&z(t,i,o[i]);return t},c=(t,o)=>Le(t,Ne(o));var Q=(t,o)=>{var i={};for(var s in t)j.call(t,s)&&o.indexOf(s)<0&&(i[s]=t[s]);if(t!=null&&H)for(var s of H(t))o.indexOf(s)<0&&J.call(t,s)&&(i[s]=t[s]);return i};var w=t=>({autocomplete:css({position:"relative",width:"100%"}),combobox:css({position:"relative"}),inputField:css({paddingRight:a.spacingXl,textOverflow:"ellipsis",whiteSpace:"nowrap"}),toggleButton:css({position:"absolute",top:"1px",right:"1px",zIndex:1,padding:a.spacing2Xs,height:"38px"}),content:css({overflow:"auto",maxHeight:`${t}px`}),list:css({listStyle:"none",padding:`${a.spacingXs} 0`,margin:0}),groupTitle:css({padding:`${a.spacingXs} ${a.spacingM}`,lineHeight:a.lineHeightM}),noMatchesTitle:css({color:a.gray500,margin:`${a.spacingM} 0 ${a.spacingM} 0`}),item:css({display:"block",padding:`${a.spacingXs} ${a.spacingM}`,wordBreak:"break-word",whiteSpace:"break-spaces",cursor:"pointer",hyphens:"auto","&:focus, &:hover":{backgroundColor:a.gray100},"&:active":{backgroundColor:a.gray200}}),disabled:css({opacity:.5,pointerEvents:"none"}),highlighted:css({backgroundColor:a.gray100}),hidden:css({display:"none"})});var k=t=>{let{items:o,elementStartIndex:i,highlightedIndex:s,getItemProps:g,renderItem:x,inputValue:P,listMaxHeight:N=180}=t,f=w(N);return n.createElement("ul",{className:f.list,"data-test-id":"cf-autocomplete-list"},o.map((h,O)=>{let y=i+O,p=g({item:h,index:y});return n.createElement(Text,c(u({},p),{as:"li",key:y,className:cx([f.item,s===y&&f.highlighted]),"data-test-id":`cf-autocomplete-list-item-${y}`}),x?x(h,P):typeof h=="string"?n.createElement(Y,{item:h,inputValue:P}):h)}))};k.displayName="AutocompleteItems";function Y({item:t,inputValue:o}){let{before:i,match:s,after:g}=getStringMatch(t,o);return n.createElement(n.Fragment,null,i,n.createElement("b",null,s),g)}Y.displayName="HighlightedItem";function Ue(t,o){let {isOpen:i,onClose:s,onOpen:g,id:x,className:P,clearAfterSelect:N=!1,textOnAfterSelect:f=N?"clear":"replace",closeAfterSelect:h=!0,defaultValue:O="",selectedItem:y,items:p,inputValue:$,onInputValueChange:C,onSelectItem:te,onFocus:V,onBlur:G,renderItem:_,icon:oe=n.createElement(ChevronDownIcon,{variant:"muted"}),itemToString:ne=e=>e,isInvalid:ie,isDisabled:X,isRequired:se,isReadOnly:re,showEmptyList:pe,noMatchesMessage:ae="No matches found",placeholder:le="Search",inputRef:me,toggleRef:ue,listRef:ce,listWidth:de="auto",listMaxHeight:ge=180,isGrouped:M=!1,isLoading:S=!1,usePortal:he=!1,testId:Ie="cf-autocomplete",popoverTestId:fe="cf-autocomplete-container"}=t,m=w(ge),[ye,Te]=useState(O),I=typeof $=="undefined"?ye:$,v=useCallback(e=>{Te(e),C==null||C(e);},[C]),be=useCallback(e=>{let r=e.target.value;v(r);},[v]),ve=L(M)?p.reduce((e,r)=>[...e,...r.options],[]):p,xe=L(M)?p.every(e=>e.options.length===0):p.length===0,{getComboboxProps:Pe,getInputProps:Ce,getItemProps:U,getMenuProps:Me,getToggleButtonProps:Se,highlightedIndex:W,isOpen:Ae,openMenu:Ee,toggleMenu:He}=useCombobox({isOpen:i,onIsOpenChange:({isOpen:e})=>{e?g==null||g():s==null||s();},stateReducer:(e,{type:r,changes:T})=>{switch(r){case useCombobox.stateChangeTypes.InputBlur:return c(u({},T),{inputValue:e.inputValue});case useCombobox.stateChangeTypes.InputKeyDownEnter:case useCombobox.stateChangeTypes.ItemClick:return h?T:c(u({},T),{isOpen:e.isOpen});default:return T}},items:ve,selectedItem:y,inputValue:I,itemToString:ne,onInputValueChange:({type:e,inputValue:r})=>{switch(e){case useCombobox.stateChangeTypes.InputChange:return;case useCombobox.stateChangeTypes.ItemClick:case useCombobox.stateChangeTypes.InputKeyDownEnter:{if(f==="clear"){v("");return}if(f==="preserve")return}}v(r);},onStateChange:({type:e,selectedItem:r})=>{switch(e){case useCombobox.stateChangeTypes.InputKeyDownEnter:case useCombobox.stateChangeTypes.ItemClick:r&&te(r);break;}}}),K=Ce(),A=Q(K,["aria-labelledby","id"]),we=Pe(),q=Se(),E=Me(),R=0;return n.createElement("div",{"data-test-id":Ie,className:cx(m.autocomplete,P),ref:o},n.createElement(Popover,{usePortal:he,isOpen:Ae,isFullWidth:de==="full",renderOnlyWhenOpen:!1,autoFocus:!1,id:E.id},n.createElement(Popover.Trigger,null,n.createElement("div",c(u({},we),{className:m.combobox}),n.createElement(TextInput,c(u({className:m.inputField},A),{onFocus:e=>{V==null||V(e),Ee();},onBlur:e=>{G==null||G(e),A.onBlur(e);},id:x,isInvalid:ie,isDisabled:X,isRequired:se,isReadOnly:re,ref:mergeRefs(A.ref,me),testId:"cf-autocomplete-input",placeholder:le,onChange:e=>{A.onChange(e),be(e);}})),n.createElement(IconButton,c(u({},q),{ref:mergeRefs(q.ref,ue),"aria-label":I?"Clear":"Show list",className:m.toggleButton,variant:"transparent",icon:I?n.createElement(CloseIcon,{variant:"muted"}):oe,onClick:()=>{I?v(""):He();},isDisabled:X,size:"small"})))),p.length>0||I.length>0||pe?n.createElement(Popover.Content,c(u({},E),{ref:mergeRefs(E.ref,ce),className:m.content,testId:fe}),S&&[...Array(3)].map((e,r)=>n.createElement("div",{key:r,className:cx(m.item,m.disabled)},n.createElement(We,null))),!S&&xe&&n.createElement("div",{className:m.item},n.createElement(Subheading,{className:m.noMatchesTitle},ae)),!S&&L(M)&&p.map((e,r)=>{if(e.options.length<1)return;let T=n.createElement("div",{key:r},n.createElement(SectionHeading,{key:r,"data-test-id":"cf-autocomplete-grouptitle",marginBottom:"none",className:m.groupTitle},e.groupTitle),n.createElement(k,{items:e.options,highlightedIndex:W,getItemProps:U,renderItem:_,inputValue:I,elementStartIndex:R}));return R+=e.options.length,T}),!S&&!L(M)&&p.length>0&&n.createElement(k,{items:p,elementStartIndex:R,highlightedIndex:W,getItemProps:U,renderItem:_,inputValue:I})):n.createElement("div",c(u({},E),{className:cx(m.hidden)}))))}var We=()=>n.createElement(Skeleton.Container,{svgHeight:16},n.createElement(Skeleton.BodyText,{numberOfLines:1}));function L(t,o){return t}var qe=n.forwardRef(Ue);

export { qe as Autocomplete };
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.js.map